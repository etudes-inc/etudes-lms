	## this is showing the list view of all announcement, and the home view of this tool

##(gsilver - remaining issues: trimming body, <p> in body when produced with WYS, the fact that how thing look in the synopsys is still undefined - and finally - the permissions nightmare as well as the ling to Remove...

############################################# Check if message hidden macro begin
#macro(rowTRconstruct $props $displayOptions $draft $merged)

	#set($now = $timeservice.newTime())
	#set($reldateset = false)
	
	#if (!$props.isEmpty() && $props.getProperty("releaseDate"))
		#set($releasedate = $props.getTimeProperty("releaseDate"))
		#set($reldateset = $now.before($releasedate))
	#end

   ## not released and not a draft
	#if ($reldateset && !$draft)
			class="inactive"
	#end
	
	#if (!$merged) 
		class="lightHighLightRow"
	#end

#end
############################################# Check if message hidden macro end

		
<script type="text/javascript" language="javascript">
function selectAll()
{
  var listSizeVal = 0;
  if (document.getElementById("showListSize") != null || document.getElementById("showListSize") != undefined)
  	listSizeVal = document.getElementById("showListSize").value;
  	
  var allcheckVal = false;
  if (document.getElementById("allcheck")!= null || document.getElementById("allcheck") != undefined)
  	allcheckVal = document.getElementById("allcheck").checked;
    	    	  
    for (i=1;i<=parseInt(listSizeVal);i++)
    {	
	     if ( document.getElementById("check-"+i) != null ||  document.getElementById("check-"+i) != undefined)
	    {
			  if (allcheckVal == true)
			  	    document.getElementById("check-"+i).checked=true;	    
			  else 	document.getElementById("check-"+i).checked=false;
		} 	 
	}
}
</script>

	
<div class="portletBody">
	#if ($isOnWorkspaceTab.equals("false"))
		#if($menu && $EnabledMenuItemExists)
			#if ($toolId == "sakai.synoptic.announcement")
				<div class="navIntraTool">
					<a href="#" title="$tlang.getString("gen.recopt")" onclick="location = '#toolLink("$action" "doOptions")';return false;">
						<img src="/sakai-announcement-tool/images/user1_preferences.gif" height="16" width="16" border="0" /> $tlang.getString("custom.options")
					</a>
				</div>
			#else
				#toolbar($menu)
			#end
		#end
	#end
	
	#set ($SiteColumnFlag = 0)
	#foreach ($item in $showMessagesList2)
	#set ($ref = $entityManager.newReference($item.Reference))
	#set ($origChannelRef = $service.channelReference($ref.Context,$ref.Container))
	#if (!$origChannelRef.equals($channel.Reference))
		#set ($SiteColumnFlag = $SiteColumnFlag + 1)
	#end
	#end
	
	#if ($isOnWorkspaceTab.equals("true")) ##in workspace
		<h3>$tlang.getString("gen.announcements")</h3>
		#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end
##		#if ($messageListVector.iterator().hasNext())
		<div class="navPanel">
			<div class="viewNav">
				<form name="viewForm" class="inlineForm" method="post" action="#toolForm("AssignmentAction")">
					<input type="hidden" name="eventSubmit_doView" value="view" />
					<label for="view">
						$tlang.getString("view.label")
					</label>
					<span class="skip">$tlang.getString("gen.listnavselect")</span>
					<select id="view" name="view" size="1" onchange="blur();document.viewForm.submit();">
						<option value="view.all" #if ($!view == "view.all")selected="selected"#end >$!tlang.getString('view.all')</option>
						<option value="view.public"  #if ($!view == "view.public")selected="selected"#end >$!tlang.getString('view.public')</option>
						#if ($!groups)
							<option value="view.bygroup" #if ($!view == "view.bygroup")selected="selected"#end >$!tlang.getString('view.bygroup')</option>
						#end 
					</select>
				</form>
			</div>
	##		#end
			<br />
				#if ($messageListVector.iterator().hasNext())
					<div class="listNav">
						<div class="instruction">
							$tlang.getString("gen.viewing") $topMsgPos - $btmMsgPos $tlang.getString("gen.separator") $allMsgNumber $tlang.getString("gen.items")
						</div>
						#if ($pagesize != 0)
							#if ($goFPButton == "true")
								<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_first" value="|&lt;" title="$tlang.getString("gen.first")" />
								</form>
							#else
								<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_first" value="|&lt;" disabled="disabled" />
								</form>
							#end
							#if ($goPPButton == "true")
								<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_prev" value="&lt;" title="$tlang.getString('gen.previous') $pagesize"  accesskey="p" />
								</form>
							#else
								<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_prev" value="&lt;" disabled="disabled" />
								</form>
							#end
						#end
						<form name="pagesizeForm" class="inlineForm" method="post" action="#toolForm("$action")">
							<input type="hidden" name="eventSubmit_doChange_pagesize" value="changepagesize" />
							<span class="skip">$tlang.getString("gen.listnavselect")</span>
							<select name="selectPageSize" onchange="blur();document.pagesizeForm.submit();">
								<option value="30" #if($pagesize == 30) selected="selected" #end>$tlang.getString("gen.show30")</option>
								<option value="100" #if($pagesize == 100) selected="selected" #end>$tlang.getString("gen.show100")</option>
								<option value="$allMsgNumberInt" #if($pagesize == $allMsgNumberInt) selected="selected" #end>$tlang.getString("gen.showall")</option>
							</select>
						</form>
						#if ($pagesize != 0)
							#if ($goNPButton == "true")
								<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_next" value="&gt;" title="$tlang.getString('gen.next') $pagesize"  accesskey="n" />
								</form>
							#else
								<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_next" value="&gt;" disabled="disabled" />
								</form>
							#end
							#if ($goLPButton == "true")
								<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_last" value="&gt;|" title="$tlang.getString('gen.last')" />
								</form>
							#else
								<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
									<input type="submit" name="eventSubmit_doList_last" value="&gt;|" disabled="disabled" />
								</form>
							#end
						#end
					</div>
				</div> ##end navPanel
				<form name="announcementListForm" action="#toolForm("AnnouncementAction")" method="post">
				<table class="listHier lines nolines" border="0" cellspacing="0" summary="$tlang.getString('gen.tablecaptionworksp')">
					<tr>
						<th id="attach" class="attach"></th>
						<th id ="subject">
							#if (!$currentSortedBy.equals("subject"))
								<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" title ="$tlang.getString('gen.sortby')">$tlang.getString('gen.subject')</a>
							#else
								#if ($currentSortAsc.equals("true"))
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" title ="$tlang.getString('gen.sortbyasc')">$tlang.getString('gen.subject') <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortbyasc')" /></a>
								#else
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" title ="$tlang.getString('gen.sortbydesc')">$tlang.getString('gen.subject') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString('gen.sortbydesc')"/></a>
								#end
							#end
						</th>
						<th id="author">
							#if (!$currentSortedBy.equals("from"))
								<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauth')">$tlang.getString('gen.from')</a>
							#else
								#if ($currentSortAsc.equals("true"))
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauthasc')">$tlang.getString('gen.from') <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortbyauthasc')" /></a>
								#else
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauthdesc')">$tlang.getString('gen.from') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString('gen.sortbyauthdesc')"/></a>
								#end
							#end
						</th>
						#if ($SiteColumnFlag > 0) ## (there are anns from other sites so show what site they are from)
							<th id ="Site">
								#if (!$currentSortedBy.equals("channel"))
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString('gen.sortchannel')">$tlang.getString('gen.site')</a>
								#else
									#if ($currentSortAsc.equals("true"))
										<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString('gen.sortchanasc')">$tlang.getString('gen.site') <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortchanasc')" /></a>
									#else
										<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString('gen.sortchandesc')">$tlang.getString('gen.site') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString('gen.sortchandesc')" /></a>
									#end
								#end
							</th>
						#end
						#if ($toolId.equals("sakai.announcements"))
							<th id ="date">
								#if (!$currentSortedBy.equals("date"))
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;"  onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydate')">$tlang.getString('gen.date')</a>
								#else
									#if ($currentSortAsc.equals("true"))
										 <a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;"  onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydateasc')">$tlang.getString('gen.date')<img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortbydateasc')" /></a>
									#else
										<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;"  onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydatedesc')">$tlang.getString('gen.date') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt ="$tlang.getString('gen.sortbydatedesc')" /></a>
									#end
								#end
							</th>
							<th id="releaseDate">
								#if (!$currentSortedBy.equals("releaseDate"))
									<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedateasc')">$tlang.getString("gen.releasedate")</a>
								#else
									#if ($currentSortAsc.equals("true"))
										 <a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedateasc')">$tlang.getString("gen.releasedate") <img src = "#imageLink('sakai/sortascending.gif')" border="0" alt="$tlang.getString('gen.sortbyreleasedateasc')" /></a>
									#else
										<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;"  onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedatedesc')">$tlang.getString("gen.releasedate") <img src = "#imageLink('sakai/sortdescending.gif')" border="0" alt ="$tlang.getString('gen.sortbyreleasedatedesc')" /></a>
									#end
								#end
							</th>
														
						#end
					</tr>
					#if ($!view == "view.all")
					#set ($rowCount=0)
					#foreach ($ann_item in $showMessagesList)
						#set ($rowCount =$rowCount + 1)
						#set($ann_item_props=$ann_item.getProperties())
						#set ($merged = true)
						<tr #rowTRconstruct($ann_item_props $displayOptions $ann_item.Header.draft $merged) >
							<td headers="attach" class="attach">	
								## show the paperclip if existing
									#set ($size = 0)
									#if (!$ann_item.Header.Attachments.isEmpty())
										#set ($props = false)
										#set ($size = $ann_item.Header.Attachments.size())
										#foreach ($attachment in $ann_item.Header.Attachments)
											#set ($props = $attachment.Properties)
											#if (!$props)
													#if ($size > 0) #set ($size = $size - 1) #end
											#end
										#end
									#end
									#if ($size == 0)
									#else
										<img src = "#imageLink("sakai/attachments.gif")" border="0" alt="$tlang.getString('gen.attach')" />
									#end

							</td>
							<td headers="subject">
								<h4>
									#if ($ann_item.Header.draft)
									<a href="#toolLinkParam("AnnouncementAction" "doReviseannouncement" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.editdraft')"><span class="highlight">$tlang.getString("gen.draft") - </span>
										$validator.escapeHtml($ann_item.Header.subject)</a>
									#else
										<a href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">
										$validator.escapeHtml($ann_item.Header.subject)</a>
									#end
								</h4>	
							</td>
							<td headers="author">
								$validator.escapeHtml($ann_item.Header.From.DisplayName)
							</td>
							#if ($SiteColumnFlag > 0)
								<td headers="channel">
									$validator.escapeHtml($ann_item.channelDisplayName)
								</td>
							#end
							#if ($toolId.equals("sakai.announcements"))
								<td headers="date">
									$ann_item.Header.Date.toStringLocalFull()
								</td>
								<td headers="releaseDate">
                                    #if (!$ann_item_props.isEmpty() && $ann_item_props.getProperty("releaseDate"))
											$ann_item_props.getTimeProperty("releaseDate").toStringLocalFull()
									#else
											&nbsp;	
									#end								
								</td>
								
							#end
						</tr>
						#if ($displayOptions.isShowAnnouncementBody()) 
							<tr>	
									#if ($EnableItemCheckBoxes)
										#if ($SiteColumnFlag > 0)
											#set ($colspan="6")
										#else	
											#set ($colspan="5")
										#end	
									#else
										#if ($SiteColumnFlag > 0)
											#set ($colspan="4")
											#else	
												#set ($colspan="3")
											#end	
										#end	
									<td colspan="$colspan">
										<div class="textPanel">$ann_item.TrimmedBody</div>
									</td>
								</tr>	
							#end
						#end
					</table>
				</form>
			#end
		#else
			</div> ##end navPanel						
			<div class="instruction clear">
				#if ($!view == "view.public")
					$tlang.getString("gen.therearepublic")
				#else
					$tlang.getString("gen.thereare")
					#end
			</div>
		#end
	#else ## not in workspace
		#if ($toolId == "sakai.synoptic.announcement") 
		##in home portlet  - so reduce display to title, attach marker, body (if selected), author and date


			#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end

			<form name="announcementListForm" action="#toolForm("AnnouncementAction")" method="post">
				#if (!$messageListVector.iterator().hasNext())
					<div class="instruction clear">
      					$tlang.getString("gen.thereare")
					</div>
				#else
					#set ($rowCount=0)
					#foreach ($ann_item in $showMessagesList)
						#set ($rowCount =$rowCount + 1)
						#set($ann_item_props=$ann_item.getProperties())
							#if ($ann_item.Header.draft)
							#else
							<h3 class="textPanelHeader">
								<a class="toolUiLinkU" href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">
								$validator.escapeHtml($ann_item.Header.subject)</a>
								#set ($size = 0)
								#if (!$ann_item.Header.Attachments.isEmpty())
									#set ($props = false)
									#set ($size = $ann_item.Header.Attachments.size())
									#foreach ($attachment in $ann_item.Header.Attachments)
										#set ($props = $attachment.Properties)
										#if (!$props)
												#if ($size > 0) #set ($size = $size - 1) #end
										#end
									#end
								#end
								#if ($size == 0)
								#else
									<img src = "#imageLink("sakai/attachments.gif")" border="0" alt="$tlang.getString('gen.attach')" />
								#end
							</h3>	
							<p class="textPanelFooter">
								($validator.escapeHtml($ann_item.Header.From.DisplayName)  
                                    #if (!$ann_item_props.isEmpty() && $ann_item_props.getProperty("releaseDate"))
										- Posted $ann_item_props.getTimeProperty("releaseDate").toStringLocalFull()
									#else
										- Modified $ann_item.Header.Date.toStringLocalFull()	
									#end )
							</p>	
							#if ($displayOptions.isShowAnnouncementBody())
								<div class="textPanel">
									$ann_item.TrimmedBody
								</div>
							#end
						#end	
						</li>
					#end
					</ul>
				#end
			</form>

		#else ## not in workspace, not in home
			#if ($toolId == "sakai.announcements") ##In tool or admin MOTD...			
			<input type="hidden" id="checkOption2" value="$displayOptions.isShowAnnouncementBody()" />
			
				#if ($displayOptions.isShowAllColumns())
					<p class="shorttext">
						#if ($allow_new && !$allow_preview)
							<img src="/sakai-announcement-tool/images/announcements.png" height="16" width="16" style="border:0" alt=""  />
							$tlang.getString("gen.studentview")
						#else #if ($allow_new && $allow_preview)
							   <img src="/sakai-announcement-tool/images/author.png" height="16" width="16" style="border:0" alt=""  />
								$tlang.getString("gen.authorview")
							#else 
								<img src="/sakai-announcement-tool/images/announcements.png" height="16" width="16" style="border:0" alt=""  />
								$tlang.getString("gen.announcements")
							#end
						#end	
					</p>
					#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end
					<div class="navPanel">
						<div class="viewNav">
						   #if ($allow_new && $allow_preview)
							<form name="viewForm" class="inlineForm" method="post" action="#toolForm("$action")">
								<input type="hidden" name="eventSubmit_doView" value="view" />
								<label for="view">
									$tlang.getString("view.label")
								</label>
								<span class="skip">$tlang.getString("gen.listnavselect")</span>
								<select id="view" name="view" size="1" onchange="blur();document.viewForm.submit();">
									<option value="view.all" #if ($!view == "'view.all")selected="selected"#end >$!tlang.getString('view.all')</option>
									<option value="view.public"  #if ($!view == "view.public")selected="selected"#end >$!tlang.getString('view.public')</option>
									#if ($!groups)
										<option value="view.bygroup" #if ($!view == "view.bygroup")selected="selected"#end >$!tlang.getString('view.bygroup')</option>
									#end 
								</select>
							</form>
							#else 
								<br/> 
							#end
						</div>	
						<br />
						#if ($displayOptions.isShowAnnouncementBody())
						<div class="listNav">
						    #if ($messageListVector.iterator().hasNext())							
								<div class="instruction">
									$tlang.getString("gen.viewing") $topMsgPos - $btmMsgPos $tlang.getString("gen.separator") $allMsgNumber $tlang.getString("gen.items")
								</div>
								#if ($pagesize != 0)
									#if ($goFPButton == "true")
										<form name="firstpageForm" class="inlineForm"  method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_first" value="|&lt;" title="$tlang.getString("gen.first")" />
										</form>
									#else
										<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_first" value="|&lt;" disabled="disabled" />
										</form>
									#end
									#if ($goPPButton == "true")
										<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_prev" value="&lt;" title="$tlang.getString('gen.previous') $pagesize"  accesskey="p" />
										</form>
								#else
										<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_prev" value="&lt;" disabled="disabled" />
										</form>
									#end
							#end
							
								<form name="pagesizeForm" class="inlineForm" method="post" action="#toolForm("$action")">
								<input type="hidden" name="eventSubmit_doChange_pagesize" value="changepagesize" />
									<span class="skip">$tlang.getString("gen.listnavselect")</span>
									<select name="selectPageSize" onchange="blur();document.pagesizeForm.submit();">
										<option value="30" #if($pagesize == 30) selected="selected" #end>$tlang.getString("gen.show30")</option>
										<option value="100" #if($pagesize == 100) selected="selected" #end>$tlang.getString("gen.show100")</option>
										<option value="$allMsgNumberInt" #if($pagesize == $allMsgNumberInt) selected="selected" #end>$tlang.getString("gen.showall")</option>
									</select>
								</form>
								#if ($pagesize != 0)
									#if ($goNPButton == "true")
										<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_next" value="&gt;" title="$tlang.getString('gen.next') $pagesize"  accesskey="n" />
										</form>
									#else
										<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_next" value="&gt;" disabled="disabled" />
										</form>
									#end
									#if ($goLPButton == "true")
										<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_last" value="&gt;|" title="$tlang.getString("gen.last")" />
										</form>
									#else
										<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
											<input type="submit" name="eventSubmit_doList_last" value="&gt;|" disabled="disabled" />
										</form>
									#end
								#end
							  #else 
								<br/> 	<br/>							
							  #end	
							</div>	
							#end				  					
					<br />	<br />						
						</div> 			
	
						<form id ="announcementListForm" name="announcementListForm" action="#toolForm("AnnouncementAction")" method="post">
						<input type="hidden" name="sakai_action" id="sakai_action" value="" />
							#if ($isOnWorkspaceTab.equals("false"))
								#if ($EnableItemCheckBoxes)	
									#if (!$displayOptions.isShowAnnouncementBody())						
										<div id="saveDndTop" style="background: #EEEEEE;border: 0;margin: 5px 0 0 0;line-height:12em;padding-left: 1em;"></div>
									#end
									
									<div class="navIntraToolLink" >
									<table cellspacing="3" cellpadding="3" summary="$tlang.getString('gen.tablecaptionsite')" width="100%" style="border: 1px solid #EAEAEA;border-collapse: collapse;">
										<tr>
										<td>
											<table cellspacing="10" cellpadding="10" summary="$tlang.getString('gen.tablecaptionsite')" width="35%" border="0" >
												<tr>	
																						
												#if ($allow_new)
												<td style="white-space: nowrap">	
													<a class="toolUiLink" href="#" onclick="location='#toolLink("AnnouncementAction" "doNewannouncement")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doNewannouncement")';return false;" title ="$tlang.getString('gen.new')"> 
														<img src="/sakai-announcement-tool/images/document_add.gif" height="16" width="16" border="0"/> $tlang.getString('gen.new')</a>
												</td>
												#end
												#if ($allow_delete)	
												<td style="white-space: nowrap">											
												<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doDeleteannouncement';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doDeleteannouncement';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.delete2')"> 
														<img src="/sakai-announcement-tool/images/delete.png" height="16" width="16" border="0"/> $tlang.getString('gen.delete2')</a>	
												</td>
												#end	
												#if ($allow_revise)
												<td style="white-space: nowrap">													
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doPublishannouncement';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doPublishannouncement';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.publish')"> 
														<img src="/sakai-announcement-tool/images/publish.png" height="16" width="16" border="0" /> $tlang.getString('gen.publish')</a>
												</td>
												<td style="white-space: nowrap">				
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doUnpublishAnnouncement';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doUnpublishAnnouncement';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.unpublish')"> 
														<img src="/sakai-announcement-tool/images/publish_rmv.png" height="16" width="16" border="0"/> $tlang.getString('gen.unpublish')</a>
												</td>
												<td style="white-space: nowrap">				
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doArchiveAnnouncementLink';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doArchiveAnnouncementLink';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.archive')"> 
														<img src="/sakai-announcement-tool/images/make_inactive.png" height="16" width="16" border="0"/> $tlang.getString('gen.archive')</a>
												</td>
												#end
												#if ($allow_new || $allow_revise)
												<td style="white-space: nowrap">				
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doRestoreAnnouncementLink';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doRestoreAnnouncementLink';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.restore')"> 
														<img src="/sakai-announcement-tool/images/restore.png" height="16" width="16" border="0"/> $tlang.getString('gen.restore')</a>
												</td>
												#end
																																
												</tr>
												</table>
										</td>										
										</tr>
									</table>
									</div>	
								#else									
									<div class="navIntraToolLink" >
									#if ($allow_new && !$allow_preview)
									<table cellspacing="3" cellpadding="3" summary="$tlang.getString('gen.tablecaptionsite')" width="100%" style="border: 1px solid #EAEAEA;border-collapse: collapse;">
										<tr>
											<td>												
												<a class="toolUiLink" href="#" onclick="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" title ="$tlang.getString('gen.return')"> 
													<img src="/sakai-announcement-tool/images/return_sm.png" height="16" width="16" border="0" /> $tlang.getString('gen.return')</a>
											</td>										
										</tr>
									</table>
									#end	
									</div>																
								#end
							#end
			
							#if ($messageListVector.iterator().hasNext())							
							<input type="hidden" id="showListSize" value="$allMsgNumberInt" />
							<input type="hidden" id="checkSortOption" value="$currentSortedBy" />
							
							<table id="reOrderItems" class="listHier lines sortTableClass" border="0" cellspacing="0" summary="$tlang.getString('gen.tablecaptionsite')">
							<thead>
								<tr>
										#if ($allow_delete && $allow_preview)
											<th class="attach" id="checkbox"><input type="checkbox" id="allcheck" onclick="javascript:selectAll()"/>										
											</th>
										#else <th id="checkbox"> </th>	
										#end
								<th id ="publishStatus" class="attach"></th>
								<th id ="viewAnnc" class="attach"></th>
								 <th id ="attach" class="attach"></th>
								 <th id ="subject">
								 	#if ($allow_new && $allow_preview)
										#if (!$currentSortedBy.equals("subject"))
											<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" title ="$tlang.getString('gen.sortby')">$tlang.getString('gen.subject')</a>
										#else
											#if ($currentSortAsc.equals("true"))
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" title ="$tlang.getString('gen.sortbyasc')">$tlang.getString('gen.subject') <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortbyasc')" /></a>
											#else
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbysubject")';return false;"title ="$tlang.getString('gen.sortbydesc')">$tlang.getString('gen.subject') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString('gen.sortbydesc')"/></a>
											#end
										#end
									 #else $tlang.getString('gen.subject')
									 #end
									</th>
									<th id="author">
									#if ($allow_new && $allow_preview)
										#if (!$currentSortedBy.equals("from"))
											<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauth')">$tlang.getString('gen.from')</a>
										#else
											#if ($currentSortAsc.equals("true"))
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauthasc')">$tlang.getString('gen.from') <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt="$tlang.getString('gen.sortbyauthasc')" /></a>
											#else
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfrom")';return false;" title ="$tlang.getString('gen.sortbyauthdesc')">$tlang.getString('gen.from') <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt="$tlang.getString('gen.sortbyauthdesc')"/></a>
											#end
										#end
										 #else $tlang.getString('gen.from')
									 #end
									</th>
									#if ($EnableItemCheckBoxes)
										#if ($SiteColumnFlag > 0) ## (there are anns from other sites so show what site they are from)
											<th id ="Site">
												#if ($allow_new && $allow_preview)
												#if (!$currentSortedBy.equals("channel"))
													<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString("gen.sortchannel")">$tlang.getString("gen.site")</a>
												#else
													#if ($currentSortAsc.equals("true"))
														<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString("gen.sortchanasc")">$tlang.getString("gen.site") <img src = "#imageLink("sakai/sortascending.gif")" border="0" alt=$tlang.getString("gen.sortchanasc") /></a>
													#else
														<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbychannel")';return false;" title ="$tlang.getString("gen.sortchandesc")">$tlang.getString("gen.site") <img src = "#imageLink("sakai/sortdescending.gif")" border="0" alt=$tlang.getString("gen.sortchandesc")/></a>
													#end
												#end
												 #else $tlang.getString('gen.site')
												 #end
											</th>
										#end
									#end
									<th id="channel">
										#if ($allow_new && $allow_preview)
										#if (!$currentSortedBy.equalsIgnoreCase("$tlang.getString('gen.visible')"))
											<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" title="$tlang.getString('gen.sortbyfor')">$tlang.getString("gen.visible")</a>
										#else
											#if ($currentSortAsc.equals("true"))
												 <a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" title="$tlang.getString('gen.sortbyforasc')">$tlang.getString("gen.visible") <img src = "#imageLink('sakai/sortascending.gif')" border="0" alt="$tlang.getString('gen.sortbyforasc')" /></a>
											#else
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyfor")';return false;" title="$tlang.getString('gen.sortbyfordesc')">$tlang.getString("gen.visible") <img src = "#imageLink('sakai/sortdescending.gif')" border="0" alt ="$tlang.getString('gen.sortbyfordesc')" /></a>
											#end
										#end
									 #else $tlang.getString('gen.visible')
									 #end
									</th>
									<th id ="date">
									  #if ($allow_new && $allow_preview)
										#if (!$currentSortedBy.equals("date"))
											<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydateasc')">$tlang.getString("gen.date")</a>
										#else
											#if ($currentSortAsc.equals("true"))
												 <a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydateasc')">$tlang.getString("gen.date") <img src = "#imageLink('sakai/sortascending.gif')" border="0" alt="$tlang.getString('gen.sortbydateasc')" /></a>
											#else
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbydate")';return false;" title="$tlang.getString('gen.sortbydatedesc')">$tlang.getString("gen.date") <img src = "#imageLink('sakai/sortdescending.gif')" border="0" alt ="$tlang.getString('gen.sortbydatedesc')" /></a>
											#end
										#end
									 #else $tlang.getString('gen.date')
									 #end
									</th>
									<th id="releaseDate">
										#if ($allow_new && $allow_preview)
										#if (!$currentSortedBy.equals("releaseDate"))
											<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedateasc')">$tlang.getString("gen.releasedate")</a>
										#else
											#if ($currentSortAsc.equals("true"))
												 <a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedateasc')">$tlang.getString("gen.releasedate") <img src = "#imageLink('sakai/sortascending.gif')" border="0" alt="$tlang.getString('gen.sortbyreleasedateasc')" /></a>
											#else
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;"  onkeypress="location='#toolLink("AnnouncementAction" "doSortbyreleasedate")';return false;" title="$tlang.getString('gen.sortbyreleasedatedesc')">$tlang.getString("gen.releasedate") <img src = "#imageLink('sakai/sortdescending.gif')" border="0" alt ="$tlang.getString('gen.sortbyreleasedatedesc')" /></a>
											#end
										#end
									 #else $tlang.getString('gen.releasedate')
									 #end
									</th>
									<th>&nbsp;</th>	
								</tr>
							 </thead>
							<tbody>
							 #set ($rowCount=0)
							 #foreach ($ann_item in $showMessagesList)
								#set ($rowCount =$rowCount + 1)
								#set($ann_item_props=$ann_item.getProperties())
								#set ($ref = $entityManager.newReference($ann_item.Reference))
								#set ($origChannelRef = $service.channelReference($ref.Context,$ref.Container))

								<tr #rowTRconstruct($ann_item_props $displayOptions $ann_item.Header.draft $origChannelRef.equals($channel.Reference)) >
															
										#if ($channel.allowRemoveMessage($ann_item.Message) && $allow_preview)
											#if ($origChannelRef.equals($channel.Reference))
											<td headers="checkbox" class="attach">
												<label for ="check-$rowCount" class="skip">$tlang.getString("gen.selectremove")</label>
												<input title="$tlang.getString("gen.selectremove")" type="checkbox" id="check-$rowCount" name="selectedMembers" value="$ann_item.Reference" />
											</td>
											#else 
													<td> &nbsp; </td>
											#end											
										#else
									 		#if ($allow_delete && $allow_preview)
												#if ($origChannelRef.equals($channel.Reference))
												<td valign="top" headers="checkbox" class="attach">
													<label for ="check-$rowCount" class="skip">$tlang.getString("gen.selectremove")</label>
													<input title="$tlang.getString("gen.selectremove")" type="checkbox" id="check-$rowCount" name="selectedMembers" value="$ann_item.Reference" disabled="disabled"/>
												</td>										
												
												#else 
													<td> &nbsp; </td>
												#end											
											#else 
												<td> &nbsp; </td>
											#end		
										#end
									
									<td headers="publishStatus" class="attach">
									#if ($allow_delete)
										#if ($ann_item.Header.draft)
											<img src = "/sakai-announcement-tool/images/forbidden.png" border="0" alt="$tlang.getString('gen.draft')" title="$tlang.getString('gen.draft')" />
										#else
											<img src = "/sakai-announcement-tool/images/publish.png" border="0" alt="$tlang.getString('gen.publishtag')"  title="$tlang.getString('gen.publishtag')"/>
										#end	
									#else 
										 &nbsp; 
									#end	
									</td>
									<td headers="viewAnnc" class="attach">
									#if ($allow_revise && $allow_preview)
									<a href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">
										<img src = "/sakai-announcement-tool/images/preview.png" border="0" /> </a>
									#else &nbsp;	
									#end	
									</td>								
									<td headers="attach" class="attach">
										## show the paperclip if existing
										#set ($size = 0)
										#if (!$ann_item.Header.Attachments.isEmpty())
											#set ($props = false)
											#set ($size = $ann_item.Header.Attachments.size())
											#foreach ($attachment in $ann_item.Header.Attachments)
												#set ($props = $attachment.Properties)
												#if (!$props)
														#if ($size > 0) #set ($size = $size - 1) #end
												#end
											#end
										#end
										#if ($size == 0)
											&nbsp;
										#else
											<img src = "#imageLink("sakai/attachments.gif")" border="0" alt="$tlang.getString('gen.attach')" />
										#end
									</td>
									<td headers="subject">
										#if ($channel.allowEditMessage($ann_item.Id) && $allow_preview)
											<div><a class="toolUiLink" href="#toolLinkParam("AnnouncementAction" "doReviseannouncement" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.editann') $validator.escapeHtml($ann_item.Header.subject)">$validator.escapeHtml($ann_item.Header.subject)</a></div>
										#else
											<a class="toolUiLink" href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">$validator.escapeHtml($ann_item.Header.subject)</a></div>
                                        #end                                                                                                                                                           
									</td>
									<td headers="author">
										$validator.escapeHtml($ann_item.Header.From.DisplayName)
									</td>
									#if ($EnableItemCheckBoxes)
										#if ($SiteColumnFlag > 0)
											<td headers="channel">
												$validator.escapeHtml($ann_item.channelDisplayName)
											</td>
										#end
									#end
									<td >
										$!ann_item.getRange()
									</td>
									<td headers="date">
										$ann_item.Header.Date.toStringLocalFull()
									</td>
									
									<td headers="releaseDate">
									#if (!$ann_item_props.isEmpty() && $ann_item_props.getProperty("releaseDate"))
											$ann_item_props.getTimeProperty("releaseDate").toStringLocalFull()
									#else
											&nbsp;	
									#end
									</td>
									<td>
									#if ($EnableItemCheckBoxes && $origChannelRef.equals($channel.Reference) && !$displayOptions.isShowAnnouncementBody())	
										<div id="itemId-$rowCount" class="hide">$ann_item.Id</div>											
										<div id="reorderGrp-$rowCount" class="addDndImage"></div>																			
									#else
											&nbsp;	
									#end
									</td>
								</tr>
								#if ($displayOptions.isShowAnnouncementBody()) 
									<tr>
										<td>
										</td>
										<td colspan="10">
											<div class="textPanel">$ann_item.TrimmedBody</div>
										</td>
									</tr>	
									#end
							#end
							</tbody>
						</table>
						#else
							</div> ##end navPanel
							<div class="instruction clear">
								<div style="margin: 5px 0 5px 0;padding-left: 1em;">
								#if ($!view == "view.public")
									$tlang.getString("gen.therearepublic")
								#else
									$tlang.getString("gen.thereare")														
								#end
								</div>
							</div>
							<form name="announcementListForm" action="#toolForm("AnnouncementAction")" method="post">
							</form>
						#end	
						#if ($messageListVector.iterator().hasNext() && $allow_delete && $allow_preview)
							#if ($isOnWorkspaceTab.equals("false"))
								<div id="saveDnd" style="background: #EEEEEE;border: 0;margin: 5px 0 0 0;line-height: 12em;padding-left: 1em;"></div>
							#end
						#end
						#if ($messageListVector.iterator().hasNext())
							#if ($isOnWorkspaceTab.equals("false"))
								#if ($messageListVector.size() > 14 && $allow_delete && !$allow_preview)
								<p style="background: #EEEEEE;border: 0;margin: 5px 0 5px 0;line-height: 2em;padding-left: 1em;">	</p>
									  <table cellspacing="3" cellpadding="3" summary="$tlang.getString('gen.tablecaptionsite')" width="100%" style="border: 1px solid #EAEAEA;border-collapse: collapse;">
										<tr>
											<td>												
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" title ="$tlang.getString('gen.return')"> 
													<img src="/sakai-announcement-tool/images/return_sm.png" height="16" width="16" /> $tlang.getString('gen.return')</a>
											</td>										
										</tr>
									   </table>
									#end								
							#end
						#end
						</form>
					#else ##list view						
						<p class="shorttext">
							#if ($allow_new && !$allow_preview)
								<img src="/sakai-announcement-tool/images/announcements.png" height="16" width="16" style="border:0" alt=""  />
								$tlang.getString("gen.studentview")
							#else #if ($allow_new && $allow_preview)
								   <img src="/sakai-announcement-tool/images/author.png" height="16" width="16" style="border:0" alt=""  />
									$tlang.getString("gen.authorview")
								#else 
									<img src="/sakai-announcement-tool/images/announcements.png" height="16" width="16" style="border:0" alt=""  />
									$tlang.getString("gen.announcements")
								#end
							#end	
						</p>						
						
						#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear"></div>#end

						#if ($messageListVector.iterator().hasNext())
							<div class="navPanel">
								<div class="listNav">
									<div class="instruction">
										##$tlang.getString("gen.viewing") $topMsgPos - $btmMsgPos / $allMsgNumber $tlang.getString("gen.items")
										  $tlang.getString("gen.viewing") $topMsgPos - $btmMsgPos $tlang.getString("gen.separator") $allMsgNumber $tlang.getString("gen.items")
									</div>
									#if ($pagesize != 0)
										#if ($goFPButton == "true")
											<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_first" value="|&lt;" title="$tlang.getString("gen.first")" />
											</form>
										#else
											<form name="firstpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_first" value="|&lt;" disabled="disabled" />
											</form>
										#end
										#if ($goPPButton == "true")
											<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_prev" value="&lt;" title="$tlang.getString('gen.previous') $pagesize"  accesskey="p" />
											</form>
										#else
											<form name="prevpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_prev" value="&lt;" disabled="disabled" />
											</form>									
										#end
									#end
									<form name="pagesizeForm" class="inlineForm" method="post" action="#toolForm("$action")">
										<input type="hidden" name="eventSubmit_doChange_pagesize" value="changepagesize" />
										<span class="skip">$tlang.getString("gen.listnavselect")</span>
										<select name="selectPageSize" onchange="blur();document.pagesizeForm.submit();">
											<option value="30" #if($pagesize == 30) selected="selected" #end>$tlang.getString("gen.show30")</option>
											<option value="100" #if($pagesize == 100) selected="selected" #end>$tlang.getString("gen.show100")</option>
											<option value="$allMsgNumberInt" #if($pagesize == $allMsgNumberInt) selected="selected" #end>$tlang.getString("gen.showall")</option>
										</select>
									</form>
									#if ($pagesize != 0)
										#if ($goNPButton == "true")
											<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_next" value="&gt;" title="$tlang.getString('gen.next') $pagesize"  accesskey="n" />
											</form>
										#else
											<form name="nextpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_next" value="&gt;" disabled="disabled" />
											</form>
										#end				
										#if ($goLPButton == "true")
											<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_last" value="&gt;|" title="$tlang.getString("gen.last")" />
											</form>
										#else
											<form name="lastpageForm" class="inlineForm" method="post" action="#toolForm("$action")">
												<input type="submit" name="eventSubmit_doList_last" value="&gt;|" disabled="disabled" />
											</form>
										#end
									#end
##									<br />
								</div>
							</div>
							#else 
							<br/><br/>
							#end
																
							<input type="hidden" id="showListSize" value="$allMsgNumberInt" />
							<form name="announcementListForm" action="#toolForm("AnnouncementAction")" method="post">
							<input type="hidden" name="sakai_action" id="sakai_action" value="" />
							
										#if ($EnableItemCheckBoxes)									
									<div class="navIntraToolLink" >
									<table cellspacing="3" cellpadding="3" summary="$tlang.getString('gen.tablecaptionsite')" width="100%" style="border: 1px solid #EAEAEA;border-collapse: collapse;">
										<tr>
										<td>
											<table cellspacing="10" cellpadding="10" summary="$tlang.getString('gen.tablecaptionsite')" width="35%" border="0" >
												<tr>	
																						
												#if ($allow_new)
												<td style="white-space: nowrap">	
													<a href="#" onclick="location='#toolLink("AnnouncementAction" "doNewannouncement")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doNewannouncement")';return false;" title ="$tlang.getString('gen.new')"> 
														<img src="/sakai-announcement-tool/images/document_add.gif" height="16" width="16" border="0"/> $tlang.getString('gen.new')</a>
												</td>
												#end
												#if ($allow_delete)	
												<td style="white-space: nowrap">											
												<a href="#" onclick="document.getElementById('sakai_action').value='doDeleteannouncement';document.announcementListForm.submit();" onkeypress="document.getElementById('sakai_action').value='doDeleteannouncement';document.announcementListForm.submit();" title ="$tlang.getString('gen.delete2')"> 
														<img src="/sakai-announcement-tool/images/delete.png" height="16" width="16" border="0"/> $tlang.getString('gen.delete2')</a>	
												</td>
												#end	
												#if ($allow_revise)
												<td style="white-space: nowrap">													
													<a href="#" onclick="document.getElementById('sakai_action').value='doPublishannouncement';document.announcementListForm.submit();" onkeypress="document.getElementById('sakai_action').value='doPublishannouncement';document.announcementListForm.submit();" title ="$tlang.getString('gen.publish')"> 
														<img src="/sakai-announcement-tool/images/publish.png" height="16" width="16" border="0" /> $tlang.getString('gen.publish')</a>
												</td>
												<td style="white-space: nowrap">				
													<a href="#" onclick="document.getElementById('sakai_action').value='doUnpublishAnnouncement';document.announcementListForm.submit();" onkeypress="document.getElementById('sakai_action').value='doUnpublishAnnouncement';document.announcementListForm.submit();" title ="$tlang.getString('gen.unpublish')"> 
														<img src="/sakai-announcement-tool/images/publish_rmv.png" height="16" width="16" border="0"/> $tlang.getString('gen.unpublish')</a>
												</td>
												<td style="white-space: nowrap">				
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doArchiveAnnouncementLink';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doArchiveAnnouncementLink';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.archive')"> 
														<img src="/sakai-announcement-tool/images/make_inactive.png" height="16" width="16" border="0"/> $tlang.getString('gen.archive')</a>
												</td>
												#end
												#if ($allow_new || $allow_revise)
												<td style="white-space: nowrap">				
													<a class="toolUiLink" href="#" onclick="document.getElementById('sakai_action').value='doRestoreAnnouncementLink';document.getElementById('announcementListForm').submit();" onkeypress="document.getElementById('sakai_action').value='doRestoreAnnouncementLink';document.getElementById('announcementListForm').submit();" title ="$tlang.getString('gen.restore')"> 
														<img src="/sakai-announcement-tool/images/restore.png" height="16" width="16" border="0"/> $tlang.getString('gen.restore')</a>
												</td>
												#end
																																
												</tr>
												</table>
										</td>										
										</tr>
									</table>
									</div>	
								#else																		
									<div class="navIntraToolLink" >
									#if ($allow_new && !$allow_preview)
									<table cellspacing="3" cellpadding="3" summary="$tlang.getString('gen.tablecaptionsite')" width="100%" style="border: 1px solid #EAEAEA;border-collapse: collapse;">
										<tr>
											<td>												
												<a href="#" onclick="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" onkeypress="location='#toolLink("AnnouncementAction" "doCancelStudentView")';return false;" title ="$tlang.getString('gen.return')"> 
													<img src="/sakai-announcement-tool/images/return_sm.png" height="16" width="16" border="0" /> $tlang.getString('gen.return')</a>
											</td>										
										</tr>
									</table>
									#end	
									</div>																
								#end	
							#if ($messageListVector.iterator().hasNext())	
							<table class="listHier" border="0" cellspacing="0" cellpadding="1" summary="$tlang.getString("gen.tablecaptionsitebody") ">
							<tr style="background: #EEEEEE;">
								
										#if ($allow_delete && $allow_preview)
											<td  class="attach" id="checkbox"><input type="checkbox" id="allcheck" onclick="javascript:selectAll()"/>										
											</td>
										#else <td class="attach" id="checkbox"> </td>	
										#end		
										<td id ="publishStatus" class="attach"></td>
										<td id ="viewAnnc" class="attach"></td>		
										<td id ="attachments" class="attach"></td>						
										<td id ="subject"></td>
										<td></td>										
							</tr>			
							 #set ($rowCount=0)
							 #foreach ($ann_item in $showMessagesList)
								#set ($rowCount =$rowCount + 1)
								<tr class="highLightRow">			
									
										#if ($channel.allowRemoveMessage($ann_item.Message) && $allow_preview)
											#if ($origChannelRef.equals($channel.Reference))
											<td headers="checkbox" class="attach">
												<label for ="check-$rowCount" class="skip">$tlang.getString("gen.selectremove")</label>
												<input title="$tlang.getString("gen.selectremove")" type="checkbox" id="check-$rowCount" name="selectedMembers" value="$ann_item.Reference" />
											</td>
											#else 
													<td> &nbsp; </td>
											#end											
										#else
									 		#if ($allow_delete && $allow_preview)
												#if ($origChannelRef.equals($channel.Reference))
												<td valign="top" headers="checkbox" class="attach">
													<label for ="check-$rowCount" class="skip">$tlang.getString("gen.selectremove")</label>
													<input title="$tlang.getString("gen.selectremove")" type="checkbox" id="check-$rowCount" name="selectedMembers" value="$ann_item.Reference" disabled="disabled"/>
												</td>										
												
												#else 
													<td> &nbsp; </td>
												#end											
											#else 
												<td> &nbsp; </td>
											#end		
										#end									
									<td headers="publishStatus" class="attach">
									#if ($allow_delete)
										#if ($ann_item.Header.draft)
											<img src = "/sakai-announcement-tool/images/forbidden.png" border="0" alt="$tlang.getString('gen.draft')" title="$tlang.getString('gen.draft')" />
										#else
											<img src = "/sakai-announcement-tool/images/publish.png" border="0" alt="$tlang.getString('gen.publishtag')"  title="$tlang.getString('gen.publishtag')"/>
										#end	
									#else 
										 &nbsp; 
									#end	
									</td>
									<td headers="viewAnnc" class="attach">
										#if ($allow_revise && $allow_preview)
										<a href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">
											<img src = "/sakai-announcement-tool/images/preview.png" border="0" /> </a>
										#else &nbsp;	
										#end	
									</td>								
									 <td>
									 ## show the paperclip if existing
										#set ($size = 0)
										#if (!$ann_item.Header.Attachments.isEmpty())
											#set ($props = false)
											#set ($size = $ann_item.Header.Attachments.size())
											#foreach ($attachment in $ann_item.Header.Attachments)
												#set ($props = $attachment.Properties)
												#if (!$props)
														#if ($size > 0) #set ($size = $size - 1) #end
												#end
											#end
										#end
										#if ($size == 0)
											&nbsp;
										#else
											<img src = "#imageLink("sakai/attachments.gif")" border="0" alt="$tlang.getString('gen.attach')" />
										#end
										</td>								
									 	<td headers="subject">									 	
										 	<h4>
										 	#if ($channel.allowEditMessage($ann_item.Id) && $allow_preview)
												<a class="toolUiLinkU" href="#toolLinkParam("AnnouncementAction" "doReviseannouncement" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.editann') $validator.escapeHtml($ann_item.Header.subject)">$validator.escapeHtml($ann_item.Header.subject)</a>
											#else
												<a class="toolUiLinkU" href="#toolLinkParam("AnnouncementAction" "doShowmetadata" "itemReference=$validator.escapeUrl($ann_item.reference)")" title="$tlang.getString('gen.viewann') $validator.escapeHtml($ann_item.Header.subject)">$validator.escapeHtml($ann_item.Header.subject)</a>
                                       		#end																				
											</h4>
										</td>
										#if (!$displayOptions.isShowAnnouncementBody())
											<td>
										/	($validator.escapeHtml($ann_item.Header.From.DisplayName) - $ann_item.Header.Date.toStringLocalFull())
											</td>
										#else 	<td> &nbsp; </td>
										#end
																	
									#if ($displayOptions.isShowAnnouncementBody())
										</tr>
										<tr>
											## need to test this with the WYSIWIG - if a <p> is created...										
											<td colspan="6">
													<p class="textPanelFooter">
														($validator.escapeHtml($ann_item.Header.From.DisplayName) - $ann_item.Header.Date.toStringLocalFull())
													</p>	
												<div class="textPanel">$ann_item.TrimmedBody</div>
											</td>
										</tr>
									#end
								#end
						</table>
						</form>
					#else
					<p class="instruction">
							<div style="margin: 5px 0 5px 0;padding-left: 1em;">
								$tlang.getString("gen.thereare")
							</div>
						</p>				
					#end
				#end ## show columns					
			#end ## in tool end	
		  #end ## 
		#end	
</div>
